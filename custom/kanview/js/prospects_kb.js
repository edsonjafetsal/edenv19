document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanban_prospects" class="tabs"></div>');var a=null,e=null,t=compareVersions(DOL_VERSION,"5.0.7"),n=compareVersions(DOL_VERSION,"6.0.0"),o=compareVersions(DOL_VERSION,"6.0.6"),r=compareVersions(DOL_VERSION,"7.0.0"),c=compareVersions(DOL_VERSION,"8.0.0");$(function(){a=ej.DataManager(kanbanData),e=$("#kanban_prospects").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:a,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"kanban_status",fields:{content:"code_client_nom",primaryKey:"rowid",priority:"priority",tag:prospects_tag,title:"",color:"fk_prospectlevel",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:colorMapping,externalDropTarget:""},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},cardDrag:function(e){var t;void 0!==$(".e-targetclone").css("top")&&(t=$(window).scrollTop(),isElementVisibleOnView($(".e-targetclone"))?$(".e-targetclone").css({position:"relative",top:0}):$(".e-targetclone").css({position:"absolute",top:t}))},cardDragStop:function(o){var i=$(o.draggedElement).prop("id"),e=$(o.draggedElement).parent().data("ej-mappingkey"),t=$(o.dropTarget).parent().data("ej-mappingkey"),n=document.URL.split("?")[0],a=columnIDs[t];void 0===t||void 0===e||t===e||"PROSPECT_STATUS_UNKNOWN"===t?(o.cancel=!0,$("#kanban_prospects").find(".e-targetclone").remove(),$("body").css("cursor","default")):(n=(n=(n=(n+="?"+$("#listactionsfilter").serialize())+"&id="+i+"&newStatusID="+a)+"&newKeyMapping="+t+"&action=cardDrop")+"&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),$.ajax({url:n,type:"GET",dataType:"html",async:!1,success:function(e,t){try{var n=JSON.parse(e);return token=n.token,$("#input_token").val(token),"OK"===n.status?($(".badge").each(function(e){void 0!==n.data.kanbanHeaderCounts[this.id]&&(this.textContent=n.data.kanbanHeaderCounts[this.id])}),window.setTimeout(function(){$("#"+i).css("border-color","magenta")},100),$.jnotify(n.message),!0):($.jnotify(n.message,"warning",5e3),$("#kanban_projets").find(".e-targetclone").remove(),$("body").css("cursor","default"),!(o.cancel=!0))}catch(e){$.jnotify(e,"error",5e3),o.cancel=!0}},error:function(e,t,n){o.cancel=!0,alert(n)},complete:function(e,t){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}}),tooltipsActive=!1)},cardDrop:function(e){},cardClick:function(e){if(!tooltipsActive){var t,n,o=a.dataSource.json.length;for(i=0;i<o;i++)t=a.dataSource.json[i].rowid,n=a.dataSource.json[i].tooltip_content,$("#prospect-"+t).ejTooltip({content:n}),$(".tooltip-ref-"+t).each(function(e){$(this).text(a.dataSource.json[i].code_client)});tooltipsActive=!0}},contextClick:function(e){"ejMenuClick"!=e.type&&"contextClick"!=e.type||e.text!=msgPrintKanbanView||this.print()},queryCellInfo:function(e){var t=-1===n?"soc.php":"card.php";null!=e.data.rowid&&""!=e.data.rowid&&null!=e.data.nom&&""!=e.data.nom&&$(e.card).find("div.e-card_image").wrap('<a href="'+DOL_URL_ROOT+"/societe/"+t+"?socid="+e.data.rowid+'" title="'+e.data.nom+'" target="_blank"></a>')}}).data("ejKanban"),$("#fk_pays_input_filtre").change(function(){var e=$(this).val(),t=-1===(t=document.URL.split("?")[0]).indexOf("?")?t+"?":t+"&";t+="idpays="+e+"&action=countryChange&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),$.ajax({url:t,type:"GET",dataType:"json",async:!0,success:function(e,t){console.log(e),token=e.token,$("#input_token").val(token),"OK"==e.status?$("#fk_departement_input_filtre").html(e.data):$("#messages").html(e.message)},error:function(e,t,n){alert(n)},complete:function(e,t){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}})})}),window.onerror=function(e,t,n,o,i){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(e),!1};