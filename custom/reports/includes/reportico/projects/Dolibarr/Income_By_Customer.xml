<?xml version="1.0"?><Report><ReportQuery><Format><ReportTitle>IncomeByCustomer</ReportTitle><ReportDescription></ReportDescription><PageSize>A4</PageSize><PageOrientation>Portrait</PageOrientation><TopMargin></TopMargin><BottomMargin></BottomMargin><RightMargin></RightMargin><LeftMargin></LeftMargin><pdfFont></pdfFont><pdfFontSize></pdfFontSize><PreExecuteCode>if($this-&gt;target_format != 'PDF'){
                $checks = $_criteria[&quot;Hidecolumns&quot;]-&gt;get_criteria_value(&quot;VALUE&quot;,false);

                for ($ct = 0; $ct &lt; count($this-&gt;columns); $ct++)
                {
                $col = $this-&gt;columns[$ct];
                if ( $col-&gt;query_name == &quot;nom&quot; &amp;&amp; preg_match(&quot;/[1]/&quot;, $checks) )
                {
                $col-&gt;attributes[&quot;column_display&quot;] = &quot;hide&quot;;
                }
                if ( $col-&gt;query_name == &quot;TotalFormat&quot; &amp;&amp; preg_match(&quot;/[2]/&quot;, $checks) )
                {
                $col-&gt;attributes[&quot;column_display&quot;] = &quot;hide&quot;;
                }
                }
                }
            </PreExecuteCode><formBetweenRows>solidline</formBetweenRows><gridDisplay>show</gridDisplay><gridSortable>yes</gridSortable><gridSearchable>yes</gridSearchable><gridPageable>.DEFAULT</gridPageable><gridPageSize>.DEFAULT</gridPageSize></Format><Datasource><SourceType>database</SourceType><SourceConnection><DatabaseType>mysql</DatabaseType><DatabaseName></DatabaseName><HostName></HostName><ServiceName></ServiceName><UserName></UserName><Password></Password></SourceConnection></Datasource><EntryForm><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection>all</RowSelection><SQL><QuerySql></QuerySql><SQLRaw>SELECT
    (select sum(ff.total_ttc) from llx_facture as ff where ff.fk_soc = s.rowid [AND ff.datef between {Date,RANGE1} and
        {Date,RANGE2}] AND (ff.fk_statut &gt;0 AND
	ff.fk_statut &lt;3 OR ff.close_code &lt;&gt; 'replaced')) as total_ttc,
    s.rowid fk_soc, s.nom nom, CONCAT (u.firstname,' ',u.lastname) as comercial, u.rowid as user
FROM llx_societe as s
         inner join llx_facture as f ON s.rowid = f.fk_soc
         left join llx_societe_commerciaux as sc on sc.fk_soc = s.rowid
         left join llx_user as u on u.rowid = sc.fk_user
WHERE 1 = 1 [AND s.rowid IN ({Customer})] [AND sc.fk_user IN ({Comercial})]
	AND f.entity=1 AND COALESCE((select sum(ff.total_ttc) from llx_facture as ff where ff.fk_soc = s.rowid AND (ff.fk_statut &gt;0 AND
	ff.fk_statut &lt;3 OR ff.close_code &lt;&gt; 'replaced')), 0) &gt; 0
GROUP BY
    s.rowid, f.fk_soc, s.nom, u.rowid, u.firstname, u.lastname, sc.fk_user
    [HAVING total_ttc &gt; {limite}]
ORDER BY u.rowid, s.nom ASC</SQLRaw></SQL><QueryColumns><QueryColumn><Name>total_ttc</Name><TableName></TableName><ColumnName>(select sum(ff.total_ttc) from llx_facture as ff where ff.fk_soc = s.rowid [AND ff.datef between {Date,RANGE1} and
        {Date,RANGE2}] AND (ff.fk_statut &gt;0 AND
	ff.fk_statut &lt;3 OR ff.close_code &lt;&gt; 'replaced')) as</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>fk_soc</Name><TableName>s</TableName><ColumnName>rowid</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>nom</Name><TableName>s</TableName><ColumnName>nom</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Customer</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>comercial</Name><TableName></TableName><ColumnName>CONCAT (u.firstname,' ',u.lastname) as</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>user</Name><TableName></TableName><ColumnName>u.rowid as</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>TotalFormat</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>right</justify><ColumnWidthPDF>5cm</ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Income</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>TotalTotal</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Total</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>TotalComercial</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>right</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Total</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><PreSQLS></PreSQLS></Query><Assignments><Assignment><AssignName>TotalFormat</AssignName><AssignNameNew></AssignNameNew><Expression>number_format({total_ttc},2,'.','')</Expression><Condition></Condition></Assignment><Assignment><AssignName>TotalTotal</AssignName><AssignNameNew></AssignNameNew><Expression>sum({TotalFormat})</Expression><Condition></Condition></Assignment><Assignment><AssignName>TotalTotal</AssignName><AssignNameNew></AssignNameNew><Expression>number_format({TotalTotal},2,'.','')</Expression><Condition></Condition></Assignment><Assignment><AssignName>nom</AssignName><AssignNameNew></AssignNameNew><Expression>embed_hyperlink({nom}, 'societe/soc.php?socid='.{fk_soc}.'')</Expression><Condition></Condition></Assignment><Assignment><AssignName>TotalComercial</AssignName><AssignNameNew></AssignNameNew><Expression>sum({total_ttc},{user})</Expression><Condition></Condition></Assignment><Assignment><AssignName>TotalComercial</AssignName><AssignNameNew></AssignNameNew><Expression>number_format({TotalComercial},2,'.','')</Expression><Condition></Condition></Assignment></Assignments><Criteria><CriteriaItem><Name>Date</Name><Title>Interval</Title><QueryTableName></QueryTableName><QueryColumnName>ff.datef</QueryColumnName><CriteriaType>DATERANGE</CriteriaType><CriteriaDisplay>NOINPUT</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults>FIRSTOFMONTH-LASTOFMONTH</CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>Customer</Name><Title>Customer</Title><QueryTableName></QueryTableName><QueryColumnName>f.fk_soc</QueryColumnName><CriteriaType>LOOKUP</CriteriaType><CriteriaDisplay>TEXTFIELD</CriteriaDisplay><ExpandDisplay>MULTI</ExpandDisplay><ReturnColumn>rowid</ReturnColumn><DisplayColumn>nom</DisplayColumn><OverviewColumn>nom</OverviewColumn><MatchColumn>nom</MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw>SELECT nom nom, rowid rowid
                            FROM llx_societe
                            WHERE 1 = 1 AND entity=1 AND client=1
                            ORDER BY nom ASC
                        </SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns><QueryColumn><Name>nom</Name><TableName></TableName><ColumnName>nom</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn><QueryColumn><Name>rowid</Name><TableName></TableName><ColumnName>rowid</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>Comercial</Name><Title>Comercial</Title><QueryTableName></QueryTableName><QueryColumnName>sc.fk_user</QueryColumnName><CriteriaType>LOOKUP</CriteriaType><CriteriaDisplay>TEXTFIELD</CriteriaDisplay><ExpandDisplay>MULTI</ExpandDisplay><ReturnColumn>rowid</ReturnColumn><DisplayColumn>nom</DisplayColumn><OverviewColumn>nom</OverviewColumn><MatchColumn>nom</MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw>SELECT CONCAT(firstname, ' ', lastname ) nom, rowid rowid
FROM llx_user
WHERE 1 = 1 AND entity=1
ORDER BY firstname ASC</SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns><QueryColumn><Name>nom</Name><TableName></TableName><ColumnName>CONCAT(firstname, ' ', lastname )</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn><QueryColumn><Name>rowid</Name><TableName></TableName><ColumnName>rowid</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>limite</Name><Title>AmountGreatherThan</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>TEXTFIELD</CriteriaType><CriteriaDisplay>NOINPUT</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults>0.01</CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>Hidecolumns</Name><Title>HideColumns</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>LIST</CriteriaType><CriteriaDisplay>CHECKBOX</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList>Customer=1,Income=2</CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem></Criteria><Output><PageHeaders></PageHeaders><PageFooters></PageFooters><DisplayOrders><DisplayOrder><ColumnName>nom</ColumnName><OrderNumber>1</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>total_ttc</ColumnName><OrderNumber>2</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>fk_soc</ColumnName><OrderNumber>3</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>TotalFormat</ColumnName><OrderNumber>4</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>TotalTotal</ColumnName><OrderNumber>5</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>comercial</ColumnName><OrderNumber>6</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>TotalComercial</ColumnName><OrderNumber>7</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>user</ColumnName><OrderNumber>8</OrderNumber></DisplayOrder></DisplayOrders><Groups><Group><GroupName>REPORT_BODY</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders></GroupHeaders><GroupTrailers><GroupTrailer><GroupTrailerDisplayColumn>TotalFormat</GroupTrailerDisplayColumn><GroupTrailerValueColumn>TotalTotal</GroupTrailerValueColumn><GroupTrailerCustom></GroupTrailerCustom></GroupTrailer></GroupTrailers></Group><Group><GroupName>comercial</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders><GroupHeader><GroupHeaderColumn>comercial</GroupHeaderColumn><GroupHeaderCustom></GroupHeaderCustom></GroupHeader></GroupHeaders><GroupTrailers><GroupTrailer><GroupTrailerDisplayColumn>TotalFormat</GroupTrailerDisplayColumn><GroupTrailerValueColumn>TotalComercial</GroupTrailerValueColumn><GroupTrailerCustom></GroupTrailerCustom></GroupTrailer></GroupTrailers></Group></Groups><Graphs><Graph><GraphColumn>REPORT_BODY</GraphColumn><GraphColor>white</GraphColor><Title></Title><GraphWidth>.DEFAULT</GraphWidth><GraphHeight>.DEFAULT</GraphHeight><GraphWidthPDF>.DEFAULT</GraphWidthPDF><GraphHeightPDF>.DEFAULT</GraphHeightPDF><XTitle></XTitle><YTitle></YTitle><GridPosition>.DEFAULT</GridPosition><XGridDisplay>.DEFAULT</XGridDisplay><XGridColor>.DEFAULT</XGridColor><YGridDisplay>.DEFAULT</YGridDisplay><YGridColor>.DEFAULT</YGridColor><XLabelColumn>nom</XLabelColumn><TitleFont>.DEFAULT</TitleFont><TitleFontStyle>.DEFAULT</TitleFontStyle><TitleFontSize>.DEFAULT</TitleFontSize><TitleColor>.DEFAULT</TitleColor><XTitleFont>.DEFAULT</XTitleFont><XTitleFontStyle>.DEFAULT</XTitleFontStyle><XTitleFontSize>.DEFAULT</XTitleFontSize><XTitleColor>.DEFAULT</XTitleColor><YTitleFont>.DEFAULT</YTitleFont><YTitleFontStyle>.DEFAULT</YTitleFontStyle><YTitleFontSize>.DEFAULT</YTitleFontSize><YTitleColor>.DEFAULT</YTitleColor><XAxisColor>.DEFAULT</XAxisColor><XAxisFont>.DEFAULT</XAxisFont><XAxisFontStyle>.DEFAULT</XAxisFontStyle><XAxisFontSize>.DEFAULT</XAxisFontSize><XAxisFontColor>.DEFAULT</XAxisFontColor><YAxisColor>.DEFAULT</YAxisColor><YAxisFont>.DEFAULT</YAxisFont><YAxisFontStyle>.DEFAULT</YAxisFontStyle><YAxisFontSize>.DEFAULT</YAxisFontSize><YAxisFontColor>.DEFAULT</YAxisFontColor><XTickInterval>.DEFAULT</XTickInterval><YTickInterval>.DEFAULT</YTickInterval><XTickLabelInterval>.DEFAULT</XTickLabelInterval><YTickLabelInterval>.DEFAULT</YTickLabelInterval><MarginColor>.DEFAULT</MarginColor><MarginLeft>.DEFAULT</MarginLeft><MarginRight>.DEFAULT</MarginRight><MarginTop>.DEFAULT</MarginTop><MarginBottom>.DEFAULT</MarginBottom><Plots><Plot><PlotColumn>total_ttc</PlotColumn><PlotType>BAR</PlotType><LineColor>#000000</LineColor><DataType>number</DataType><Legend>Income</Legend><FillColor></FillColor></Plot></Plots></Graph></Graphs></Output></EntryForm></ReportQuery></Report>