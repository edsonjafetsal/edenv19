<?xml version="1.0"?><Report><ReportQuery><Format><ReportTitle>Modelo 347</ReportTitle><ReportDescription></ReportDescription><PageSize>A4</PageSize><PageOrientation>Portrait</PageOrientation><TopMargin></TopMargin><BottomMargin></BottomMargin><RightMargin></RightMargin><LeftMargin></LeftMargin><pdfFont></pdfFont><pdfFontSize></pdfFontSize><PreExecuteCode>NONE</PreExecuteCode><formBetweenRows>solidline</formBetweenRows><gridDisplay>.DEFAULT</gridDisplay><gridSortable>.DEFAULT</gridSortable><gridSearchable>.DEFAULT</gridSearchable><gridPageable>.DEFAULT</gridPageable><gridPageSize>.DEFAULT</gridPageSize></Format><Datasource><SourceType>database</SourceType><SourceConnection><DatabaseType>mysql</DatabaseType><DatabaseName></DatabaseName><HostName></HostName><ServiceName></ServiceName><UserName></UserName><Password></Password></SourceConnection></Datasource><EntryForm><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection>all</RowSelection><SQL><QuerySql></QuerySql><SQLRaw>SELECT f.ingreso, s.nom, s.siren, s.zip, f.trimestre, f.fk_soc, (SELECT const.value FROM llx_const const WHERE const.name LIKE 'MAIN_INFO_SOCIETE_NOM' AND entity=1) as companyName, (CASE {Type} WHEN 1 THEN &quot;Clientes&quot; ELSE &quot;Proveedores&quot; END) as typeLabel
FROM ingresos as f
        left join
    llx_societe as s ON s.rowid = f.fk_soc
WHERE 1 = 1  
[ AND {Type} = f.tipo]
GROUP BY f.fk_soc, f.trimestre, s.nom, f.ingreso
[HAVING SUM(f.total) &gt; {limite}]
ORDER BY  s.nom ASC, f.trimestre ASC</SQLRaw></SQL><QueryColumns><QueryColumn><Name>nom</Name><TableName>s</TableName><ColumnName>nom</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Tercero</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>trimestre</Name><TableName>f</TableName><ColumnName>trimestre</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Trimestre</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>ingreso</Name><TableName>f</TableName><ColumnName>ingreso</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>right</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title>Importe</column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>total</Name><TableName></TableName><ColumnName></ColumnName><ColumnType></ColumnType><ColumnLength></ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>fk_soc</Name><TableName>f</TableName><ColumnName>fk_soc</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>siren</Name><TableName>s</TableName><ColumnName>siren</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>Identificador fiscal</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>companyName</Name><TableName></TableName><ColumnName>(SELECT const.value FROM llx_const const WHERE const.name LIKE 'MAIN_INFO_SOCIETE_NOM' AND entity=1) as</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>typeLabel</Name><TableName></TableName><ColumnName>(CASE {Type} WHEN 1 THEN &quot;Clientes&quot; ELSE &quot;Proveedores&quot; END) as</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>0</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn><QueryColumn><Name>zip</Name><TableName>s</TableName><ColumnName>zip</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>hide</column_display><content_type>plain</content_type><ColumnStartPDF></ColumnStartPDF><justify>left</justify><ColumnWidthPDF></ColumnWidthPDF><ColumnWidthHTML></ColumnWidthHTML><column_title></column_title><tooltip></tooltip><group_header_label>Código postal</group_header_label><group_header_label_xpos></group_header_label_xpos><group_header_data_xpos></group_header_data_xpos><group_trailer_label>0</group_trailer_label></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><PreSQLS><PreSQL><SQLText>CREATE TEMPORARY TABLE ingresos ( ingreso float, trimestre int, fk_soc int, tipo int, total float)</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 1 as trimestre, f.fk_soc, 1 as tipo, 0 as total
FROM llx_facture as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-01-01') AND CONCAT({Date},'-03-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 2 as trimestre, f.fk_soc, 1 as tipo , 0 as total
FROM llx_facture as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-04-01') AND CONCAT({Date},'-06-30')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 3 as trimestre, f.fk_soc, 1 as tipo, 0 as total
FROM llx_facture as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-07-01') AND CONCAT({Date},'-09-30')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 4 as trimestre, f.fk_soc, 1 as tipo, 0 as total
FROM llx_facture as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-10-01') AND CONCAT({Date},'-12-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 1 as trimestre, f.fk_soc, 2 as tipo, 0 as total
FROM llx_facture_fourn as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-01-01') AND CONCAT({Date},'-03-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 2 as trimestre, f.fk_soc, 2 as tipo, 0 as total
FROM llx_facture_fourn as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-04-01') AND CONCAT({Date},'-06-30')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 3 as trimestre, f.fk_soc, 2 as tipo , 0 as total
FROM llx_facture_fourn as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-07-01') AND CONCAT({Date},'-09-30')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>INSERT INTO ingresos
SELECT sum(f.total_ttc) as ingreso, 4 as trimestre, f.fk_soc, 2 as tipo, 0 as total 
FROM llx_facture_fourn as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced')
[AND f.datef BETWEEN CONCAT({Date},'-10-01') AND CONCAT({Date},'-12-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc 
ORDER BY fk_soc</SQLText></PreSQL><PreSQL><SQLText>UPDATE ingresos as i SET i.total = (SELECT sum(f.total_ttc) as ingreso
FROM llx_facture as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced') AND i.fk_soc = f.fk_soc
[AND f.datef BETWEEN CONCAT({Date},'-01-01') AND CONCAT({Date},'-12-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc ) WHERE i.tipo = 1</SQLText></PreSQL><PreSQL><SQLText>UPDATE ingresos as i SET i.total = (SELECT sum(f.total_ttc) as ingreso
FROM llx_facture_fourn as f
WHERE 1 = 1 AND f.entity=1 AND (f.fk_statut &gt;0 AND f.fk_statut &lt;3 OR f.close_code &lt;&gt; 'replaced') AND i.fk_soc = f.fk_soc
[AND f.datef BETWEEN CONCAT({Date},'-01-01') AND CONCAT({Date},'-12-31')]
[AND f.fk_soc IN ({Customer})]
GROUP BY fk_soc ) WHERE i.tipo = 2</SQLText></PreSQL></PreSQLS></Query><Assignments><Assignment><AssignName>trimestre</AssignName><AssignNameNew></AssignNameNew><Expression> apply_style('ROW', 'background-color', '#eeeeff') </Expression><Condition>( lineno() % 2 == 1 ) </Condition></Assignment><Assignment><AssignName>trimestre</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('ROW', 'background-color', '#e0e0ff');</Expression><Condition></Condition></Assignment><Assignment><AssignName>trimestre</AssignName><AssignNameNew></AssignNameNew><Expression>apply_style('PAGE', 'border-style', 'solid');apply_style('PAGE', 'border-width', '1 1 1 1');apply_style('PAGE', 'border-color', '#222222');apply_style('PAGE', 'background-color', '#f3fff3');</Expression><Condition></Condition></Assignment><Assignment><AssignName>total</AssignName><AssignNameNew></AssignNameNew><Expression>sum({ingreso},{nom})</Expression><Condition></Condition></Assignment><Assignment><AssignName>nom</AssignName><AssignNameNew></AssignNameNew><Expression>embed_hyperlink({nom}, 'societe/soc.php?socid='.{fk_soc}.'')</Expression><Condition></Condition></Assignment><Assignment><AssignName>ingreso</AssignName><AssignNameNew></AssignNameNew><Expression>number_format({ingreso},2,'.','')</Expression><Condition></Condition></Assignment><Assignment><AssignName>total</AssignName><AssignNameNew></AssignNameNew><Expression>number_format({total},2,'.','')</Expression><Condition></Condition></Assignment></Assignments><Criteria><CriteriaItem><Name>Date</Name><Title>Año</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>TEXTFIELD</CriteriaType><CriteriaDisplay>NOINPUT</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>Customer</Name><Title>Terceros</Title><QueryTableName></QueryTableName><QueryColumnName>f.fk_soc</QueryColumnName><CriteriaType>LOOKUP</CriteriaType><CriteriaDisplay>TEXTFIELD</CriteriaDisplay><ExpandDisplay>MULTI</ExpandDisplay><ReturnColumn>rowid</ReturnColumn><DisplayColumn>nom</DisplayColumn><OverviewColumn>nom</OverviewColumn><MatchColumn>nom</MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw>SELECT nom nom, rowid rowid 
FROM llx_societe 
WHERE 1 = 1  AND entity=1 AND (client=1 OR fournisseur = 1)
ORDER BY  nom ASC</SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns><QueryColumn><Name>nom</Name><TableName></TableName><ColumnName>nom</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn><QueryColumn><Name>rowid</Name><TableName></TableName><ColumnName>rowid</ColumnName><ColumnType>char</ColumnType><ColumnLength>30</ColumnLength><Format><column_display>show</column_display><content_type>plain</content_type><justify>left</justify></Format></QueryColumn></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>Type</Name><Title>Tipo</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>LIST</CriteriaType><CriteriaDisplay>DROPDOWN</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList>Clientes=1,Proveedores=2</CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem><CriteriaItem><Name>limite</Name><Title>Importe &gt;</Title><QueryTableName></QueryTableName><QueryColumnName></QueryColumnName><CriteriaType>TEXTFIELD</CriteriaType><CriteriaDisplay>NOINPUT</CriteriaDisplay><ExpandDisplay>NOINPUT</ExpandDisplay><ReturnColumn></ReturnColumn><DisplayColumn></DisplayColumn><OverviewColumn></OverviewColumn><MatchColumn></MatchColumn><CriteriaDefaults></CriteriaDefaults><CriteriaList></CriteriaList><Query><TableSql></TableSql><WhereSql></WhereSql><GroupSql></GroupSql><RowSelection></RowSelection><SQLRaw></SQLRaw><SQL><QuerySql></QuerySql></SQL><QueryColumns></QueryColumns><OrderColumns></OrderColumns><Assignments></Assignments></Query><CriteriaLinks></CriteriaLinks></CriteriaItem></Criteria><Output><PageHeaders><PageHeader><LineNumber>1</LineNumber><HeaderText>{companyName} Modelo 347: {typeLabel}{STYLE font-weight:bold;}</HeaderText><Format><ColumnStartPDF>5%</ColumnStartPDF><justify>center</justify><ColumnWidthPDF>90%</ColumnWidthPDF><ShowInPDF>yes</ShowInPDF><ShowInHTML>yes</ShowInHTML></Format></PageHeader></PageHeaders><PageFooters><PageFooter><LineNumber>1</LineNumber><FooterText>Page pageno()</FooterText><Format><ColumnStartPDF>5%</ColumnStartPDF><justify>right</justify><ColumnWidthPDF>90%</ColumnWidthPDF><ShowInPDF>yes</ShowInPDF><ShowInHTML>no</ShowInHTML></Format></PageFooter></PageFooters><DisplayOrders><DisplayOrder><ColumnName>nom</ColumnName><OrderNumber>1</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>trimestre</ColumnName><OrderNumber>2</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>ingreso</ColumnName><OrderNumber>3</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>total</ColumnName><OrderNumber>4</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>fk_soc</ColumnName><OrderNumber>5</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>companyName</ColumnName><OrderNumber>6</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>typeLabel</ColumnName><OrderNumber>7</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>siren</ColumnName><OrderNumber>8</OrderNumber></DisplayOrder><DisplayOrder><ColumnName>zip</ColumnName><OrderNumber>9</OrderNumber></DisplayOrder></DisplayOrders><Groups><Group><GroupName>REPORT_BODY</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders></GroupHeaders><GroupTrailers></GroupTrailers></Group><Group><GroupName>nom</GroupName><BeforeGroupHeader>blankline</BeforeGroupHeader><AfterGroupHeader>blankline</AfterGroupHeader><BeforeGroupTrailer>blankline</BeforeGroupTrailer><AfterGroupTrailer>blankline</AfterGroupTrailer><GroupHeaders><GroupHeader><GroupHeaderColumn>nom</GroupHeaderColumn><GroupHeaderCustom></GroupHeaderCustom></GroupHeader><GroupHeader><GroupHeaderColumn>siren</GroupHeaderColumn><GroupHeaderCustom></GroupHeaderCustom></GroupHeader><GroupHeader><GroupHeaderColumn>zip</GroupHeaderColumn><GroupHeaderCustom></GroupHeaderCustom></GroupHeader></GroupHeaders><GroupTrailers><GroupTrailer><GroupTrailerDisplayColumn>ingreso</GroupTrailerDisplayColumn><GroupTrailerValueColumn>total</GroupTrailerValueColumn><GroupTrailerCustom></GroupTrailerCustom></GroupTrailer></GroupTrailers></Group></Groups><Graphs></Graphs></Output></EntryForm></ReportQuery></Report>